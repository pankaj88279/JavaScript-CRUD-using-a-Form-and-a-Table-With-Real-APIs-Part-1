<!DOCTYPE html>
<html lang="en">
<head>
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Document</title>
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-GLhlTQ8iRABdZLl6O3oVMWSktQOp6b7In1Zl3/Jr59b6EGGoI1aFkw7cmDA6j6gD" crossorigin="anonymous">
        <style>
        .a_tbr{
            border: 1px dashed red;
        }
        </style>
        <script>

        </script>
    </head>
    <body>
        <!-- Modal -->
         <div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="exampleModalLabel">Modal title</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                <div class="modal-body">
                    ...
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary a_closemodal" data-bs-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-primary" onclick="saveChange(this)">Save changes</button>
                </div>
                </div>
            </div>
        </div>
        <div class="container">
            <div class="row " >
                <div class="col-4 a_tbr">
                    <form onsubmit="sendMyData(this);return false;">
                        <div class="mb-3">
                        <label for="first name" class="form-label">first name</label>
                        <input type="text" class="form-control" id="firstname" aria-describedby="emailHelp">
                    
                        </div>
                        <div class="mb-3">
                        <label for="last name" class="form-label">last name</label>
                        <input autofocus type=text class="form-control" id="lastname" aria-describedby="emailHelp">
                        </div>
                        <div class="mb-3">
                       <label for="email" class="form-label">email</label>
                        <input type="email"class="form-control" id="email">
                       </div>
                       <input type="submit" value="Send" class="btn btn-primary">
                    </form>
                </div>
                <div class="col-8 a_tbr">
                    <table class="table pankajtable">
                        <thead>
                        <tr>
                            <th scope="col">id</th>
                            <th scope="col">first_name</th>
                            <th scope="col">last_name</th>
                            <th scope="col">email</th>
                            <th scope="col">action</th>       
                        </tr>
                        </thead>
                        <tbody>
                            <td>
                                <div class="spinner-border m-5" role="status">
                                    <span class="visually-hidden">Loading...</span>
                                </div>  
                            </td>
                        
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
        
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js" integrity="sha384-w76AqPfDkMBDXo30jS1Sgez6pr3x5MlQ1ZAGC+nuZB+EYdgRZgiwxhTBTkF7CXvN" crossorigin="anonymous"></script>
        <script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script> 
        <script>
            let x=document.querySelector('table.pankajtable>tbody')
            let bdy=document.querySelector('body'); 
            let mt= document.querySelector('div#exampleModal h5.modal-title');
            let mb= document.querySelector('div#exampleModal div.modal-body');
            let url='https:reqres.in';
            let tr="";
            //promise chain 
            //PO.then().then().catch();
            
            /*  fetch('http://example.com/movies.json')
            .then((response) => response.json())
            .then((data) => console.log(data));
              */
            fetch(url+'/api/users?page=2')
            .then((res)=>{
                return res.json();
            })
            .then((data)=>{             
                console.log(data.data);
                for(variable of data.data){
                    tr +=` <tr>
                                <td>${variable.id}</td>
                                <td>${variable.first_name}</td>
                                <td>${variable.last_name}</td>
                                <td>${variable.email}</td>
                                    <td>
                                    <button class="btn btn-sm btn-success" data-bs-toggle="modal" data-bs-target="#exampleModal" onclick="ViewModal(this)">View</button>
                                        <button class="btn btn-sm btn-primary" data-bs-toggle="modal" data-bs-target="#exampleModal" onclick="editModal(this)">Edit</button>
                                        <button class="btn btn-sm btn-danger" onclick="deleteUser(this)">Delete</button>
                                    </td>
                            </tr>`;
                    console.log(variable.first_name);
                }
                   x.innerHTML= tr
               
            })
            .catch((err)=>{
                console.log(err);
            }) 
            let saveChange=(elem)=>{
              let i=document.querySelector('form.editform input#userid').value;  
              let n=document.querySelector('form.editform input#fname').value;  
              let l=document.querySelector('form.editform input#lname').value;  
              let e=document.querySelector('form.editform input#email').value;
              console.log(n);  
              console.log(l);  
              console.log(e);  
              console.log(i);  
            //   you have to call api
                fetch(`${url}/api/users/${i}`,{
                    method:"PUT"
                })
                .then((d)=>{
                    console.log(d.status);
                    if(d.status == 200){
                        document.querySelector('button.a_closemodal').click();
                        swal("user updated successfully!", "You clicked the button!", "success");
                        
                    }
                })
                .catch((e)=>{
                    console.log(error); 
                });
            }
            let ViewModal=(elem)=>{
                console.log(elem)
                let email = elem.closest('td').previousElementSibling.innerHTML;
                let lname = elem.closest('td').previousElementSibling.previousElementSibling.innerHTML;
                let fname = elem.closest('td').previousElementSibling.previousElementSibling.previousElementSibling.innerHTML;
                let uid = elem.closest('td').previousElementSibling.previousElementSibling.previousElementSibling.previousElementSibling.innerHTML;
               mt.innerHTML='View Modal';
               mb.innerHTML=`<ul class="list-group">
                                    <li class="list-group-item">${fname.toUpperCase()}</li>
                                    <li class="list-group-item">${lname.toUpperCase()}</li>
                                    <li class="list-group-item">${email.toUpperCase()}</li>
                                    <li class="list-group-item">${uid.toUpperCase()}</li>
                                </ul>`
                  }
            let editModal=(elem)=>{
                let id=elem.closest('tr').querySelector('td:first-child').innerHTML;
                let nm=elem.closest('tr').querySelector('td:nth-child(2)').innerHTML;
                let ln=elem.closest('tr').querySelector('td:nth-child(3)').innerHTML;
                let eml=elem.closest('tr').querySelector('td:nth-child(4)').innerHTML;
                
                mt.innerHTML='edit Modal';
                mb.innerHTML=` <form class="editform">
                                <input type="hidden" id="userid" name="userid" value="${id}">
                                    <div class="mb-3">
                                        <label for="fname" class="form-label">first name</label>
                                        <input name="fname" value="${nm}" type="text" class="form-control" id="fname">
                                    </div>
                                    <div class="mb-3">
                                        <label for="lname" class="form-label">last name</label>
                                        <input name="lname" value="${ln}" type="text" class="form-control" id="lname">
                                    </div>
                                    <div class="mb-3">
                                        <label for="email" class="form-label">Email address</label>
                                        <input type="email" value="${eml}" class="form-control" id="email" aria-describedby="emailHelp">
                                    </div>
                                    
                                </form>`
                
            }
            let deleteUser=(elem)=>{
                console.log(elem);
                swal({
                    title: "Are you sure?",
                    text: "Once deleted, you will not be able to recover this imaginary file!",
                    icon: "warning",
                    buttons: true,
                    dangerMode: true,
                  })
                    .then((willDelete) => {
                    if (willDelete) {
                        let tr=elem.closest('tr')
                        let delit=tr.querySelector('td:first-child').innerHTML;
                        //call your api
                        fetch(`${url}/api/users/${delit}`,{
                            method:"DELETE",
                        })
                        .then((data)=>{
                            console.log(data);
                            tr.remove();
                            swal("Poof! Your imaginary file has been deleted!", {
                            icon: "success",
                        });
                        })
                        .catch((err)=>{
                            console.log(err);
                        })
                       
                    } 
                 });           
            }
            let sendMyData=(elem)=>{
            let fn=(elem.querySelector('input#firstname').value);
            let ln=(elem.querySelector('input#lastname').value);
            let eml=(elem.querySelector('input#email').value);
            if(fn ===''||ln ===''||eml ===''){
                    //true
              swal('please fill the fileds!', "You clicked the button!", "error");
            }else{
                    // false
                    bdy.innerHTML +=`<div class="d-flex justify-content-center position-fixed top-50 start-50 pkspinner">
                                    <div class="spinner-border" role="status">
                                        <span class="visually-hidden">Loading...</span>
                                    </div>
                                    </div>`;  
                //alert('okk')
                console.log(elem);  
                let jsondata = {
                    "first_name":fn,
                    "last_name":ln,
                    "email":eml
                } 
                console.log(jsondata);
                fetch(url+'/api/users',{
                    method: 'POST',
                    headers: {
                'Content-Type': 'application/json'
                        // 'Content-Type': 'application/x-www-form-urlencoded',
                        },
                    body: JSON.stringify(jsondata)  
                })
                .then((res)=>{
                    return res.json();  
                })
                .then((data)=>{
                    swal("Data saved successfully!", "You clicked the button!", "success");
                    document.querySelector('.pkspinner').remove();
                // alert('Data saved successfully')
                })
                .catch((error)=>{
                    console.log('error');
                })
            }
        }
        </script>
    </body>
</html>